#!/bin/bash
set -e  # توقف عند أول خطأ

echo "=== تثبيت SLiM من المصدر ==="

# تحقق من وجود cmake و gcc
command -v cmake >/dev/null 2>&1 || { echo "خطأ: cmake غير مثبت"; exit 1; }
command -v g++ >/dev/null 2>&1 || { echo "خطأ: g++ غير مثبت"; exit 1; }

# استنساخ SLiM إذا لم يكن موجودًا
if [ ! -d "slim" ]; then
    echo "استنساخ SLiM..."
    git clone https://github.com/MesserLab/SLiM.git slim
fi

cd slim

# تنظيف البناء السابق
rm -rf build/

# إنشاء مجلد بناء
mkdir build && cd build

# تكوين وبناء
echo "تشغيل cmake..."
cmake .. -DCMAKE_BUILD_TYPE=Release

echo "تشغيل make..."
make -j$(nproc)

# نسخ الثنائي إلى PATH
echo "تثبيت SLiM في /usr/local/bin..."
cp slim /usr/local/bin/slim

# اختبار التثبيت
echo "اختبار SLiM..."
slim -version || { echo "فشل تشغيل SLiM"; exit 1; }

echo "تم تثبيت SLiM بنجاح!"
