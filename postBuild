#!/bin/bash
set -e  # توقف عند أول خطأ

echo "بدء تثبيت SLiM..."

# تحقق من وجود cmake و g++
command -v cmake >/dev/null || { echo "خطأ: cmake غير مثبت"; exit 1; }
command -v g++ >/dev/null || { echo "خطأ: g++ غير مثبت"; exit 1; }

# استنساخ SLiM إذا لم يكن موجودًا
if [ ! -d "slim" ]; then
    echo "استنساخ SLiM من GitHub..."
    git clone --depth 1 https://github.com/MesserLab/SLiM.git slim
fi

cd slim

# تنظيف أي بناء سابق
rm -rf build
mkdir build && cd build

# تكوين المشروع
echo "تشغيل cmake..."
cmake .. -DCMAKE_BUILD_TYPE=Release

# البناء
echo "تشغيل make..."
make -j$(nproc)

# تثبيت البرنامج
echo "نسخ slim إلى /usr/local/bin..."
sudo cp slim /usr/local/bin/slim

# اختبار التثبيت
echo "اختبار SLiM..."
slim -version && echo "تم تثبيت SLiM بنجاح!"

echo "اكتمل تثبيت SLiM."
